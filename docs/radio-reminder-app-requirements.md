# ラジオ番組聞き逃し防止アプリ 要件定義書

## 1. プロジェクト概要

### 1.1 目的

radikoのタイムフリー機能を活用し、聴きたいラジオ番組の聞き逃しを防ぐためのタスク管理アプリを開発する。

### 1.2 背景

- radikoのタイムフリー機能には「放送後1週間」という視聴期限がある
- 複数の番組を管理する場合、期限を忘れて聞き逃すリスクがある
- ToDoリスト形式で番組を管理することで、計画的な視聴を支援する

### 1.3 ターゲットユーザー

- ラジオリスナー（中級者程度）
- 複数の番組を定期的に聴取するユーザー
- すき間時間を活用してラジオを聴くユーザー

## 2. 技術スタック

### 2.1 開発環境

- **フレームワーク**: React Native + Expo
- **データベース**: expo-sqlite
- **対応プラットフォーム**: iOS / Android

### 2.2 外部連携

- フェーズ1では外部API連携なし（将来的にradiko API連携を検討）

## 3. 機能要件

### 3.1 フェーズ1（MVP: 最小機能）

#### 3.1.1 番組マスタ管理機能

**番組の登録**

- 手動入力による番組情報の登録
- 登録項目：
  - 放送局名（テキスト入力）
  - 番組名（テキスト入力）
  - 放送曜日（選択式）
  - 放送時刻（時・分の選択）
  - 繰り返し設定（選択式）
    - なし（単発）
    - 毎週

**番組の編集**

- 登録済み番組情報の変更
- 繰り返し設定の変更も可能

**番組の削除**

- 繰り返し設定なしの場合：通常削除
- 繰り返し設定ありの場合：
  - 「この回だけ削除」：該当タスクのみ削除
  - 「繰り返し設定ごと削除」：番組マスタとすべての関連タスクを削除

#### 3.1.2 タスク管理機能

**タスクの自動生成**

- **番組登録時の初回タスク生成**：
  - 単発（none）の番組: 次回放送日時のタスクを1件生成
  - 毎週（weekly）の番組: **前回（1週間前）放送日時のタスクを1件生成**
    - 理由: タスク作成時には、前回放送の聴取期限がまだ来ていないため（radikoの聴取可能期間は放送から7日+29時間）
- **繰り返し設定（weekly）の次回タスク生成**：
  - 前回タスクを「聴取済み」にした時
  - 前回タスクが期限切れになり自動削除された時（アプリ起動時に処理）
  - **計算方法**: 前回タスクの放送日時から1週間後を計算
    - 理由: 期限切れタスクのクリーンアップに失敗して残っていた場合、現在時刻から計算すると前回タスクの2週間後以降のタスクが作成されてしまうため
- 生成時に期限を自動計算

**タスクのステータス管理**

- ステータス種別：
  - 未聴取（初期状態）
  - 聴取中
  - 聴取済み
- ステータスの手動変更が可能

**タスクの表示**

- 一覧表示：期限が近い順にソート
- 表示項目：
  - 放送局名
  - 番組名
  - 放送日時
  - 期限（残り日数表示）
  - ステータス

**タスクの期限管理**

- 期限：放送日時から「7日後の29時（翌日5時）」
- 期限切れタスクは自動削除
- 削除処理はアプリ起動時のみ実行
- 期限切れになった繰り返し設定（weekly）のタスクは、削除時に次回タスクを自動生成（前回タスクの放送日時から1週間後）

#### 3.1.3 通知機能

**リマインダー通知**

- 通知タイミング：期限の1日前の18時
- 通知内容：
  - 番組名
  - 放送局名
  - 残り時間（約◯時間）
- 通知設定はON固定（OFF設定なし）

#### 3.1.4 履歴管理機能

**聴取履歴の保持**

- 「聴取済み」ステータスのタスクを履歴として保持
- 保持期間：1ヶ月
- 1ヶ月経過後は自動削除

**履歴の表示**

- 聴取済みタスクの一覧表示
- 表示項目：
  - 放送局名
  - 番組名
  - 放送日時
  - 聴取完了日時

### 3.2 フェーズ2以降（将来拡張機能）

以下の機能は将来的な実装を検討：

- radiko API連携
  - 番組表からの番組選択
  - radikoアプリへの直接遷移
- フィルター・検索機能
  - 放送局別絞り込み
  - 番組名検索
- 統計機能
  - 聴取率の可視化
  - 月別聴取数グラフ
- 通知カスタマイズ
  - 通知時刻の変更
  - 通知ON/OFF設定
- バックアップ・同期機能

## 4. 非機能要件

### 4.1 パフォーマンス

- アプリ起動時間：3秒以内
- タスク一覧の表示：1秒以内
- 操作のレスポンス：即座（タップ後0.5秒以内）

### 4.2 ユーザビリティ

- シンプルで直感的なUI
- 操作の速さを最優先
- 最小限のタップ数で主要操作が完結

### 4.3 互換性

- iOS 13.0以上
- Android 10以上

### 4.4 データ管理

- ローカルストレージ（expo-sqlite）でのデータ保持
- アプリ削除時のデータ完全削除

## 5. データモデル

### 5.1 番組マスタテーブル（programs）

| カラム名     | 型      | 必須 | 説明                        |
| ------------ | ------- | ---- | --------------------------- |
| id           | INTEGER | ○    | 主キー（自動採番）          |
| station_name | TEXT    | ○    | 放送局名                    |
| program_name | TEXT    | ○    | 番組名                      |
| day_of_week  | INTEGER | ○    | 曜日（0=日曜, 6=土曜）      |
| hour         | INTEGER | ○    | 放送時刻（時）5-29          |
| minute       | INTEGER | ○    | 放送時刻（分）              |
| repeat_type  | TEXT    | ○    | 繰り返し種別（none/weekly） |
| created_at   | TEXT    | ○    | 登録日時                    |
| updated_at   | TEXT    | ○    | 更新日時                    |

### 5.2 タスクテーブル（tasks）

| カラム名           | 型      | 必須 | 説明                                         |
| ------------------ | ------- | ---- | -------------------------------------------- |
| id                 | INTEGER | ○    | 主キー（自動採番）                           |
| program_id         | INTEGER | ○    | 番組マスタID（外部キー）                     |
| broadcast_datetime | TEXT    | ○    | 放送日時（YYYY-MM-DD HH:mm:ss形式）          |
| deadline_datetime  | TEXT    | ○    | 期限日時（YYYY-MM-DD HH:mm:ss形式）          |
| status             | TEXT    | ○    | ステータス（unlistened/listening/completed） |
| completed_at       | TEXT    | -    | 聴取完了日時                                 |
| created_at         | TEXT    | ○    | 登録日時                                     |
| updated_at         | TEXT    | ○    | 更新日時                                     |

※ 単発番組の場合もprogramsテーブルにrepeat_type='none'で登録し、tasksテーブルにはprogram_idを必須で持たせる

## 6. 画面構成

### 6.1 メイン画面（タスク一覧）

- タスクリストの表示（期限が近い順）
- 各タスクにステータス変更ボタン
- 新規番組登録ボタン
- 履歴表示ボタン

### 6.2 番組登録/編集画面

- 番組情報入力フォーム
- 繰り返し設定選択
- 保存/キャンセルボタン

### 6.3 番組詳細画面

- 番組情報表示
- 編集ボタン
- 削除ボタン（繰り返し設定ありの場合は選択肢表示）

### 6.4 履歴画面

- 聴取済みタスクの一覧表示
- 日付順（新しい順）での表示

## 7. 開発スケジュール（想定）

### Phase 1: MVP開発

1. データベース設計・実装（1週間）
2. 基本UI実装（2週間）
3. タスク管理機能実装（2週間）
4. 通知機能実装（1週間）
5. テスト・デバッグ（1週間）

**合計：約7週間**

### Phase 2以降

- ユーザーフィードバックを基に優先順位を決定

## 8. リスクと対策

### 8.1 技術的リスク

- **リスク**: expo-sqliteのパフォーマンス問題
- **対策**: 初期段階でベンチマーク実施、必要に応じて別のストレージ検討

### 8.2 ユーザビリティリスク

- **リスク**: 繰り返し設定の理解が難しい
- **対策**: チュートリアル画面の実装、わかりやすい説明文の配置

### 8.3 運用リスク

- **リスク**: 通知が届かない（OSの省電力機能など）
- **対策**: 初回起動時に通知許可の案内、設定方法のヘルプ画面提供

## 9. 成功指標

### 9.1 定量指標

- アプリのクラッシュ率：1%以下
- タスク登録から完了までの平均日数：5日以内
- ユーザー継続率（1ヶ月）：60%以上

### 9.2 定性指標

- ユーザーから「操作が速い」「シンプルでわかりやすい」というフィードバック
- 聞き逃しが減ったという報告

## 10. 備考

### 10.1 用語定義

- **番組マスタ**: 繰り返し設定を含む番組の基本情報
- **タスク**: 実際に聴取する対象となる個別の放送回
- **タイムフリー**: radikoの過去番組視聴機能（1週間限定）
- **29時**: 深夜の時刻表現（翌日5時のこと）

### 10.2 今後の検討事項

- Android/iOSでの通知動作の違いへの対応
- 大量のタスクがある場合のパフォーマンス最適化
