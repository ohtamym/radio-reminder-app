# ラジオ番組聞き逃し防止アプリ 画面設計書

## 1. 画面構成概要

### 1.1 画面一覧

| 画面ID | 画面名 | 説明 |
|--------|--------|------|
| SC01 | タスク一覧画面 | メイン画面。登録されたタスクを期限順に表示 |
| SC02 | 番組登録画面 | 新規番組を登録する画面 |
| SC03 | 番組編集画面 | 既存番組の情報を編集する画面 |
| SC04 | タスク詳細画面 | 個別タスクの詳細情報を表示 |
| SC05 | 削除確認ダイアログ | 繰り返し設定タスクの削除方法を選択 |
| SC06 | 履歴画面 | 聴取済みタスクの履歴を表示 |

### 1.2 画面遷移図

```
[SC01 タスク一覧画面] ─┬─ [+]ボタン → [SC02 番組登録画面]
        │            │
        │            ├─ タスクタップ → [SC04 タスク詳細画面]
        │            │
        │            └─ [履歴]ボタン → [SC06 履歴画面]
        │
        └─ [SC04 タスク詳細画面] ─┬─ [編集]ボタン → [SC03 番組編集画面]
                                  │
                                  └─ [削除]ボタン → [SC05 削除確認ダイアログ]
                                                    (繰り返し設定ありの場合)
```

## 2. 画面詳細設計

### SC01: タスク一覧画面（メイン画面）

#### 2.1.1 画面の目的
- 登録されたタスクを期限順に一覧表示
- タスクのステータスを素早く変更
- 新規番組の登録と履歴表示への導線

#### 2.1.2 レイアウト

```
┌─────────────────────────────────┐
│ ラジオ聴取リスト          [+] │ ← ヘッダー
├─────────────────────────────────┤
│                                 │
│ ┌─────────────────────────────┐ │
│ │ 📻 TBSラジオ          🔴未聴取│ │ ← タスクカード
│ │ アフター6ジャンクション      │ │
│ │ 12/5(木) 18:00              │ │
│ │ 期限: あと1日 (12/12 05:00) │ │
│ │ [聴取中へ] [完了]           │ │
│ └─────────────────────────────┘ │
│                                 │
│ ┌─────────────────────────────┐ │
│ │ 📻 文化放送           🟡聴取中│ │
│ │ レコメン！                   │ │
│ │ 12/4(水) 22:00              │ │
│ │ 期限: あと2日 (12/11 05:00) │ │
│ │ [未聴取へ] [完了]           │ │
│ └─────────────────────────────┘ │
│                                 │
│ ┌─────────────────────────────┐ │
│ │ 📻 ニッポン放送       🔴未聴取│ │
│ │ オールナイトニッポン        │ │
│ │ 12/3(火) 25:00              │ │
│ │ 期限: あと3日 (12/10 05:00) │ │
│ │ [聴取中へ] [完了]           │ │
│ └─────────────────────────────┘ │
│                                 │
│                ︙                │
│                                 │
├─────────────────────────────────┤
│         [履歴を見る]            │ ← フッター
└─────────────────────────────────┘
```

#### 2.1.3 UI要素詳細

**ヘッダー**
- タイトル: "ラジオ聴取リスト"（左寄せ）
- [+]ボタン: 右上、番組登録画面へ遷移

**タスクカード**（リスト形式）
- 放送局名: 左上、📻アイコン付き
- ステータスインジケーター: 右上
  - 🔴未聴取（赤）
  - 🟡聴取中（黄）
  - ✅聴取済み（グレー、非表示）
- 番組名: 太字、大きめフォント
- 放送日時: 曜日含む形式（例: 12/5(木) 18:00）
- 期限表示:
  - 残り日数が1日以内: 赤文字で強調
  - 残り日数が2-3日: 黄色で表示
  - 残り日数が4日以上: 通常色
- アクションボタン:
  - 未聴取の場合: [聴取中へ] [完了]
  - 聴取中の場合: [未聴取へ] [完了]
- タップ動作: カード全体タップで詳細画面へ遷移

**ソート順**
- 期限が近い順（deadline_datetime ASC）

**空状態**
- タスクが0件の場合:
  ```
  ┌─────────────────────────────────┐
  │                                 │
  │        📻                       │
  │                                 │
  │   まだタスクがありません        │
  │                                 │
  │   右上の[+]ボタンから           │
  │   番組を登録しましょう          │
  │                                 │
  └─────────────────────────────────┘
  ```

**フッター**
- [履歴を見る]ボタン: 中央配置、履歴画面へ遷移

#### 2.1.4 操作フロー

**ステータス変更の流れ**
1. ユーザーが[聴取中へ]または[完了]ボタンをタップ
2. 即座にステータスを更新（API呼び出しなし、ローカルDB更新のみ）
3. UIを再描画
4. [完了]の場合:
   - タスクを一覧から削除（履歴へ移動）
   - 繰り返し設定（weekly）の場合は次回タスクを自動生成
   - 生成完了後、一覧を再描画

**期限切れタスクの処理**
- アプリ起動時（useEffectのマウント時）に実行
- 期限切れタスクを検出して削除
- 繰り返し設定（weekly）の場合は次回タスクを生成
- 処理完了後、一覧を再描画

---

### SC02: 番組登録画面

#### 2.2.1 画面の目的
- 新規番組の情報を入力して登録
- 繰り返し設定を選択

#### 2.2.2 レイアウト

```
┌─────────────────────────────────┐
│ ← 番組登録                      │ ← ヘッダー
├─────────────────────────────────┤
│                                 │
│ 放送局名 *                      │
│ ┌─────────────────────────────┐ │
│ │ TBSラジオ                   │ │
│ └─────────────────────────────┘ │
│                                 │
│ 番組名 *                        │
│ ┌─────────────────────────────┐ │
│ │ アフター6ジャンクション     │ │
│ └─────────────────────────────┘ │
│                                 │
│ 放送曜日 *                      │
│ ┌─────────────────────────────┐ │
│ │ 木曜日               ▼     │ │
│ └─────────────────────────────┘ │
│                                 │
│ 放送時刻 *                      │
│ ┌─────────────┬───────────────┐ │
│ │ 18    ▼   │ :  00   ▼   │ │
│ └─────────────┴───────────────┘ │
│                                 │
│ 繰り返し設定 *                  │
│ ○ なし（単発）                  │
│ ● 毎週                          │
│                                 │
├─────────────────────────────────┤
│     [キャンセル]   [登録]       │ ← フッター
└─────────────────────────────────┘
```

#### 2.2.3 UI要素詳細

**ヘッダー**
- 戻るボタン: 左上、前画面へ戻る
- タイトル: "番組登録"

**入力フォーム**
- 放送局名: テキスト入力、プレースホルダー「例: TBSラジオ」
- 番組名: テキスト入力、プレースホルダー「例: アフター6ジャンクション」
- 放送曜日: ドロップダウン選択
  - 選択肢: 日曜日、月曜日、火曜日、水曜日、木曜日、金曜日、土曜日
- 放送時刻: 
  - 時: ドロップダウン（5-29）
  - 分: ドロップダウン（0, 15, 30, 45）
- 繰り返し設定: ラジオボタン
  - なし（単発）
  - 毎週

**バリデーション**
- 全項目必須入力
- 未入力の場合、[登録]ボタン押下時にエラーメッセージ表示
- エラーメッセージ: 「すべての項目を入力してください」

**フッター**
- [キャンセル]ボタン: 左側、前画面へ戻る（確認なし）
- [登録]ボタン: 右側、入力内容を保存して戻る

#### 2.2.4 操作フロー

**登録処理の流れ**
1. ユーザーが[登録]ボタンをタップ
2. バリデーションチェック
3. programsテーブルに新規レコード挿入
4. 最初のタスクを自動生成（tasksテーブルに挿入）
   - 単発（none）の場合: 次に来る該当曜日・時刻のタスクを1件生成
   - 毎週（weekly）の場合: 次に来る該当曜日・時刻のタスクを1件生成
5. タスク一覧画面に戻る

**次回放送日時の計算ロジック**
- 現在日時を基準に、指定曜日・時刻の次の発生日時を計算
- 例: 現在が12/5(木) 15:00、設定が「木曜日 18:00」の場合
  - → 12/5(木) 18:00（当日の未来時刻）
- 例: 現在が12/5(木) 20:00、設定が「木曜日 18:00」の場合
  - → 12/12(木) 18:00（次週の同曜日）

---

### SC03: 番組編集画面

#### 2.3.1 画面の目的
- 既存番組の情報を編集
- 繰り返し設定の変更

#### 2.3.2 レイアウト

```
┌─────────────────────────────────┐
│ ← 番組編集                      │ ← ヘッダー
├─────────────────────────────────┤
│                                 │
│ 放送局名 *                      │
│ ┌─────────────────────────────┐ │
│ │ TBSラジオ                   │ │
│ └─────────────────────────────┘ │
│                                 │
│ 番組名 *                        │
│ ┌─────────────────────────────┐ │
│ │ アフター6ジャンクション     │ │
│ └─────────────────────────────┘ │
│                                 │
│ 放送曜日 *                      │
│ ┌─────────────────────────────┐ │
│ │ 木曜日               ▼     │ │
│ └─────────────────────────────┘ │
│                                 │
│ 放送時刻 *                      │
│ ┌─────────────┬───────────────┐ │
│ │ 18    ▼   │ :  00   ▼   │ │
│ └─────────────┴───────────────┘ │
│                                 │
│ 繰り返し設定 *                  │
│ ○ なし（単発）                  │
│ ● 毎週                          │
│                                 │
├─────────────────────────────────┤
│     [キャンセル]   [保存]       │ ← フッター
└─────────────────────────────────┘
```

#### 2.3.3 UI要素詳細

- 登録画面（SC02）とほぼ同じUI
- 違いは以下の点のみ:
  - ヘッダータイトル: "番組編集"
  - [登録]ボタン → [保存]ボタン
  - 初期値: 既存の番組情報が入力済み

#### 2.3.4 操作フロー

**保存処理の流れ**
1. ユーザーが[保存]ボタンをタップ
2. バリデーションチェック
3. programsテーブルの該当レコードを更新
4. 注意: 既存タスクは変更しない（過去のタスクはそのまま）
5. 前画面（タスク詳細画面）に戻る

**繰り返し設定を変更した場合の挙動**
- weekly → none: 既存タスクはそのまま、次回以降のタスクは生成されない
- none → weekly: 既存タスクはそのまま、次回完了時から繰り返し生成が始まる

---

### SC04: タスク詳細画面

#### 2.4.1 画面の目的
- タスクの詳細情報を表示
- 番組の編集・削除への導線

#### 2.4.2 レイアウト

```
┌─────────────────────────────────┐
│ ← タスク詳細                    │ ← ヘッダー
├─────────────────────────────────┤
│                                 │
│ 📻 TBSラジオ                    │
│                                 │
│ アフター6ジャンクション          │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│                                 │
│ 放送日時                        │
│ 2024年12月5日（木）18:00       │
│                                 │
│ 視聴期限                        │
│ 2024年12月12日（木）05:00      │
│ あと1日                         │
│                                 │
│ ステータス                      │
│ 🔴 未聴取                       │
│                                 │
│ 繰り返し設定                    │
│ 毎週                            │
│                                 │
├─────────────────────────────────┤
│ [ステータス変更]                │
│ ┌─────────────────────────────┐ │
│ │ ○ 未聴取                    │ │
│ │ ● 聴取中                    │ │
│ │ ○ 聴取済み                  │ │
│ └─────────────────────────────┘ │
│                                 │
│ [番組情報を編集]                │
│                                 │
│ [削除]                          │
│                                 │
└─────────────────────────────────┘
```

#### 2.4.3 UI要素詳細

**ヘッダー**
- 戻るボタン: 左上、タスク一覧画面へ戻る
- タイトル: "タスク詳細"

**情報表示エリア**
- 放送局名: 📻アイコン付き
- 番組名: 太字、大きめフォント
- 放送日時: 年月日・曜日・時刻の完全表記
- 視聴期限:
  - 日時の完全表記
  - 残り日数を別行で表示（「あと◯日」）
  - 残り1日以内は赤文字
- ステータス: 絵文字付きで現在のステータス表示
- 繰り返し設定: 「なし（単発）」または「毎週」

**操作エリア**
- [ステータス変更]セクション:
  - ラジオボタンで選択
  - 変更は即座に反映（自動保存）
  - 「聴取済み」を選択すると確認なしで完了処理
- [番組情報を編集]ボタン: 番組編集画面（SC03）へ遷移
- [削除]ボタン: 赤文字、削除処理を実行

#### 2.4.4 操作フロー

**削除ボタンタップ時の流れ**
1. 繰り返し設定を確認
2. 繰り返し設定なし（none）の場合:
   - 確認ダイアログ「このタスクを削除しますか？」
   - [キャンセル] [削除]
   - 削除実行後、タスク一覧画面へ戻る
3. 繰り返し設定あり（weekly）の場合:
   - 削除確認ダイアログ（SC05）を表示

**ステータス変更時の流れ**
1. ユーザーがラジオボタンを選択
2. 即座にtasksテーブルを更新
3. 「聴取済み」を選択した場合:
   - completed_atに現在日時を記録
   - 繰り返し設定（weekly）の場合は次回タスクを生成
   - タスク一覧画面へ自動的に戻る
4. それ以外の場合: 画面はそのまま

---

### SC05: 削除確認ダイアログ

#### 2.5.1 画面の目的
- 繰り返し設定タスクの削除方法を選択

#### 2.5.2 レイアウト

```
┌─────────────────────────────────┐
│                                 │
│  ┌───────────────────────────┐  │
│  │                           │  │
│  │   削除方法を選択          │  │
│  │                           │  │
│  │   この番組のタスクは      │  │
│  │   繰り返し設定されています │  │
│  │                           │  │
│  │   ┌─────────────────────┐ │  │
│  │   │ この回だけ削除      │ │  │
│  │   └─────────────────────┘ │  │
│  │                           │  │
│  │   ┌─────────────────────┐ │  │
│  │   │ 繰り返し設定ごと削除│ │  │
│  │   └─────────────────────┘ │  │
│  │                           │  │
│  │        [キャンセル]        │  │
│  │                           │  │
│  └───────────────────────────┘  │
│                                 │
└─────────────────────────────────┘
```

#### 2.5.3 UI要素詳細

**ダイアログ**
- タイトル: "削除方法を選択"
- 説明文: "この番組のタスクは繰り返し設定されています"
- 選択ボタン:
  - [この回だけ削除]: 現在表示中のタスクのみ削除
  - [繰り返し設定ごと削除]: 番組マスタと全関連タスクを削除
- [キャンセル]ボタン: ダイアログを閉じる

#### 2.5.4 操作フロー

**「この回だけ削除」を選択した場合**
1. 該当タスク（1件）をtasksテーブルから削除
2. programsテーブルは変更なし
3. 次回タスクは通常通り生成される
4. タスク一覧画面へ戻る

**「繰り返し設定ごと削除」を選択した場合**
1. 該当のprogram_idを持つすべてのタスクを削除
2. programsテーブルから該当番組を削除
3. タスク一覧画面へ戻る

---

### SC06: 履歴画面

#### 2.6.1 画面の目的
- 聴取済みタスクの履歴を表示
- 過去の聴取記録を確認

#### 2.6.2 レイアウト

```
┌─────────────────────────────────┐
│ ← 聴取履歴                      │ ← ヘッダー
├─────────────────────────────────┤
│                                 │
│ ┌─────────────────────────────┐ │
│ │ 📻 TBSラジオ          ✅完了 │ │
│ │ アフター6ジャンクション      │ │
│ │ 放送: 12/5(木) 18:00        │ │
│ │ 聴取: 12/8(日) 14:30        │ │
│ └─────────────────────────────┘ │
│                                 │
│ ┌─────────────────────────────┐ │
│ │ 📻 文化放送            ✅完了 │ │
│ │ レコメン！                   │ │
│ │ 放送: 11/28(木) 22:00       │ │
│ │ 聴取: 11/30(土) 10:15       │ │
│ └─────────────────────────────┘ │
│                                 │
│                ︙                │
│                                 │
│                                 │
└─────────────────────────────────┘
```

#### 2.6.3 UI要素詳細

**ヘッダー**
- 戻るボタン: 左上、タスク一覧画面へ戻る
- タイトル: "聴取履歴"

**履歴カード**
- 放送局名: 📻アイコン付き
- ✅完了マーク: 右上
- 番組名
- 放送日時: 「放送: 」プレフィックス付き
- 聴取完了日時: 「聴取: 」プレフィックス付き
- タップ動作: なし（参照のみ）

**ソート順**
- 聴取完了日時の降順（completed_at DESC）

**空状態**
- 履歴が0件の場合:
  ```
  ┌─────────────────────────────────┐
  │                                 │
  │        ✅                       │
  │                                 │
  │   まだ聴取履歴がありません      │
  │                                 │
  └─────────────────────────────────┘
  ```

**データ保持期間**
- 完了から1ヶ月経過した履歴は自動削除
- 削除処理はアプリ起動時に実行

---

## 3. 共通UI仕様

### 3.1 カラーパレット

```
プライマリーカラー: #2196F3（青）
セカンダリーカラー: #FFC107（黄）
エラーカラー: #F44336（赤）
成功カラー: #4CAF50（緑）
背景色: #FFFFFF（白）
カード背景: #F5F5F5（薄いグレー）
テキストカラー: #212121（濃いグレー）
セカンダリテキスト: #757575（グレー）
ボーダーカラー: #E0E0E0（薄いグレー）
```

### 3.2 タイポグラフィ

```
見出し1（画面タイトル）: 20px, Bold
見出し2（番組名）: 18px, Bold
本文: 16px, Regular
補足テキスト: 14px, Regular
小テキスト: 12px, Regular
```

### 3.3 スペーシング

```
画面余白: 16px
カード間隔: 12px
カード内余白: 16px
要素間余白（小）: 8px
要素間余白（中）: 16px
要素間余白（大）: 24px
```

### 3.4 ボタンスタイル

**プライマリーボタン**
- 背景色: プライマリーカラー
- テキスト色: 白
- 角丸: 8px
- 高さ: 48px
- タップ時: 透明度80%

**セカンダリーボタン**
- 背景色: 透明
- テキスト色: プライマリーカラー
- ボーダー: 1px solid プライマリーカラー
- 角丸: 8px
- 高さ: 48px

**危険ボタン（削除など）**
- 背景色: 透明
- テキスト色: エラーカラー
- ボーダー: 1px solid エラーカラー
- 角丸: 8px
- 高さ: 48px

### 3.5 カードスタイル

```
背景色: カード背景
角丸: 12px
シャドウ: 軽い影（elevation: 2）
ボーダー: なし
パディング: 16px
```

### 3.6 ステータスインジケーター

```
未聴取: 🔴（赤丸） または RED (#F44336)
聴取中: 🟡（黄丸） または YELLOW (#FFC107)
聴取済み: ✅（チェックマーク） または GREEN (#4CAF50)
```

### 3.7 期限表示の色分け

```
残り1日以内: #F44336（赤）
残り2-3日: #FFC107（黄）
残り4日以上: #757575（グレー）
```

---

## 4. レスポンシブ対応

### 4.1 画面サイズ対応

- 最小幅: 320px（iPhone SE）
- 最大幅: 428px（iPhone 14 Pro Max）
- タブレット対応: Phase 2以降で検討

### 4.2 セーフエリア対応

- iOS: ノッチ・ダイナミックアイランドを考慮
- Android: ステータスバー・ナビゲーションバーを考慮

---

## 5. アニメーション仕様

### 5.1 画面遷移

- トランジション: スライド（右から左へ）
- 所要時間: 300ms
- イージング: ease-in-out

### 5.2 リスト更新

- 新規アイテム追加: フェードイン（200ms）
- アイテム削除: フェードアウト（200ms）
- 並び替え: スムーズな位置移動（300ms）

### 5.3 ボタンフィードバック

- タップ時: スケール 0.95（100ms）
- リリース時: スケール 1.0（100ms）

---

## 6. エラーハンドリング

### 6.1 データ取得エラー

- 表示: 「データの取得に失敗しました」
- アクション: [再試行]ボタン

### 6.2 保存エラー

- 表示: 「保存に失敗しました」
- アクション: [再試行]ボタン

### 6.3 バリデーションエラー

- 表示: 入力フォーム下部に赤文字でメッセージ
- 例: 「すべての項目を入力してください」

---

## 7. アクセシビリティ

### 7.1 フォントサイズ

- システム設定のフォントサイズに対応
- 最小サイズ: 12px
- 最大サイズ: 24px（200%拡大）

### 7.2 コントラスト

- WCAG 2.1 AA基準準拠
- テキストと背景のコントラスト比: 最低4.5:1

### 7.3 タッチターゲット

- 最小サイズ: 44×44px（iOS Human Interface Guidelines準拠）
- ボタン間の余白: 最低8px

---

## 8. 通知デザイン

### 8.1 プッシュ通知

**タイトル**
```
[番組名] の期限が近づいています
```

**本文**
```
[放送局名] - [番組名]
放送: [放送日時]
期限: あと約[XX]時間
```

**例**
```
タイトル: アフター6ジャンクションの期限が近づいています
本文: TBSラジオ - アフター6ジャンクション
     放送: 12/5(木) 18:00
     期限: あと約11時間
```

### 8.2 通知タイミング

- 期限の1日前（残り約29時間）の18:00に送信

---

## 9. 今後の検討事項

### 9.1 Phase 2以降で検討する機能

- ダークモード対応
- タブレット最適化レイアウト
- スワイプジェスチャー（削除、ステータス変更）
- プルツーリフレッシュ
- タスク検索機能
- フィルタリング機能
- radikoアプリへの直接遷移

### 9.2 UX改善案

- オンボーディング画面（初回起動時）
- チュートリアルツールチップ
- 聴取完了時のマイクロインタラクション（アニメーション）
- 統計ダッシュボード（聴取率、よく聴く番組など）
